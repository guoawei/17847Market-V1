<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>編輯活動 - 市集媒合平台</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Cropper.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F3F4F6;
        }

        /* 自定義捲軸樣式 */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #F3F4F6;
        }

        ::-webkit-scrollbar-thumb {
            background: #FCD34D;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #F59E0B;
        }

        /* 裁切模態框樣式 */
        #crop-modal .cropper-container {
            max-height: 350px;
            border-radius: 12px;
            overflow: hidden;
        }

        #crop-modal .crop-preview {
            width: 100%;
            max-height: 350px;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 2px;
        }

        #crop-modal .crop-preview-inner {
            background: #1a1a1a;
            border-radius: 10px;
            overflow: hidden;
        }

        #crop-modal img {
            max-width: 100%;
            display: block;
        }

        /* 工具按鈕樣式 */
        .crop-tool-btn {
            transition: all 0.3s ease;
            position: relative;
        }

        .crop-tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .crop-tool-btn:active {
            transform: translateY(0);
        }

        /* 比例按鈕樣式 */
        .aspect-ratio-btn {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .aspect-ratio-btn.active {
            background: linear-gradient(135deg, #FCD34D 0%, #F59E0B 100%);
            color: white;
            border-color: #F59E0B;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        .aspect-ratio-btn:hover:not(.active) {
            border-color: #FCD34D;
            background-color: #FFFBEB;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #D1D5DB;
            border-radius: 24px;
            transition: 0.3s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #F59E0B;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen flex">
        <!-- 側邊欄 -->
        <div class="bg-white w-64 min-h-screen shadow-lg fixed">
            <div class="flex items-center justify-center h-16 border-b border-gray-200">
                <img class="h-8" src="https://images.unsplash.com/photo-1490127252417-7c393f993ee4?w=150&h=50&fit=crop" alt="Logo">
            </div>
            <nav class="mt-6">
                <div class="px-4 py-2">
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <img class="h-8 w-8 rounded-full object-cover" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=32&h=32&fit=crop" alt="主辦方頭像">
                        <span>歡迎回來，主辦方</span>
                    </div>
                </div>
                <div class="px-2 mt-4">
                    <a href="organizer-dashboard.html" class="flex items-center px-4 py-3 text-gray-600 hover:bg-yellow-50 rounded-lg transition-colors">
                        <i class="fas fa-home w-5 h-5"></i>
                        <span class="mx-4">首頁</span>
                    </a>
                    <a href="market-management.html" class="flex items-center px-4 py-3 mt-2 text-gray-700 bg-yellow-50 rounded-lg">
                        <i class="fas fa-store w-5 h-5"></i>
                        <span class="mx-4">我的市集</span>
                    </a>
                    <a href="vendor-review.html" class="flex items-center px-4 py-3 mt-2 text-gray-600 hover:bg-yellow-50 rounded-lg transition-colors">
                        <i class="fas fa-users w-5 h-5"></i>
                        <span class="mx-4">攤商審核</span>
                    </a>
                    <a href="market-analytics.html" class="flex items-center px-4 py-3 mt-2 text-gray-600 hover:bg-yellow-50 rounded-lg transition-colors">
                        <i class="fas fa-chart-line w-5 h-5"></i>
                        <span class="mx-4">數據分析</span>
                    </a>
                    <a href="market-settings.html" class="flex items-center px-4 py-3 mt-2 text-gray-600 hover:bg-yellow-50 rounded-lg transition-colors">
                        <i class="fas fa-cog w-5 h-5"></i>
                        <span class="mx-4">設定</span>
                    </a>
                </div>
            </nav>
        </div>

        <!-- 主要內容區 -->
        <div class="flex-1 ml-64">
            <!-- 頂部導航 -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between h-16 px-8">
                    <div class="flex items-center space-x-4">
                        <a href="market-management.html" class="text-gray-600 hover:text-gray-800">
                            <i class="fas fa-arrow-left"></i>
                        </a>
                        <h1 class="text-xl font-bold text-gray-800">編輯活動</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button class="text-gray-600 hover:text-gray-800">
                            <i class="fas fa-bell"></i>
                        </button>
                        <button class="flex items-center space-x-2">
                            <img class="h-8 w-8 rounded-full object-cover" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=32&h=32&fit=crop" alt="主辦方頭像">
                            <i class="fas fa-chevron-down text-gray-600"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- 主要內容 -->
            <main class="p-8">
                <div class="max-w-4xl mx-auto">
                    <form class="space-y-6">
                        <!-- 基本資訊 -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-lg font-bold text-gray-900">基本資訊</h2>
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">進行中</span>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">活動名稱</label>
                                    <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="2024年3月場">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">活動時間</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <input type="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="2024-03-16">
                                        </div>
                                        <div>
                                            <input type="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="2024-03-17">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">活動地點</label>
                                    <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="台北市信義區松山文創園區">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">活動照片</label>
                                    <div class="mt-1">
                                        <div class="relative">
                                            <img id="activity-image" src="https://images.unsplash.com/photo-1534237710431-e2fc698436d0?w=800&h=400&fit=crop" alt="活動照片" class="w-full h-48 object-cover rounded-lg">
                                            <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity rounded-lg">
                                                <label class="cursor-pointer bg-white px-4 py-2 rounded-lg text-gray-700 hover:bg-gray-100">
                                                    <i class="fas fa-camera mr-2"></i>
                                                    更換照片
                                                    <input type="file" id="image-input" class="hidden" accept="image/*">
                                                </label>
                                            </div>
                                        </div>
                                        <p class="mt-2 text-xs text-gray-500">建議尺寸 1200x600 像素，PNG、JPG、GIF 格式，檔案大小不超過 2MB</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 參加日期和攤位管理 -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h2 class="text-lg font-bold text-gray-900">參加日期和攤位管理</h2>
                                    <p class="text-sm text-gray-600 mt-1">管理不同的參加日期和對應的攤位配置</p>
                                </div>
                                <div class="flex space-x-3">
                                    <button type="button" onclick="openAddDateGroupModal()" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors">
                                        <i class="fas fa-plus mr-2"></i>
                                        新增參加日期
                                    </button>
                                    <button type="button" onclick="openAddBoothModal()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                        <i class="fas fa-plus mr-2"></i>
                                        新增攤位類型
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 日期列表 -->
                            <div id="date-group-list" class="space-y-6">
                                <!-- 範例參加日期 1 -->
                                <div class="border border-gray-200 rounded-lg p-6 bg-gradient-to-r from-yellow-50 to-orange-50">
                                    <div class="flex items-center justify-between mb-6">
                                        <div class="flex items-center">
                                            <div class="p-3 bg-yellow-100 rounded-lg mr-4">
                                                <i class="fas fa-calendar-week text-yellow-600 text-xl"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-xl font-bold text-gray-900">週末文創市集 - 第一週</h3>
                                                <p class="text-sm text-gray-600">活動日期：3/16（六）、3/17（日）</p>
                                                <p class="text-sm text-gray-500">時間：10:00 - 18:00</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-4">
                                            <div class="text-right">
                                                <div class="text-sm text-gray-500">總攤位數</div>
                                                <div class="font-bold text-lg text-gray-900">65</div>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <button type="button" onclick="editDateGroup('group-1')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                    <i class="fas fa-edit mr-1"></i>
                                                    編輯
                                                </button>
                                                <button type="button" onclick="deleteDateGroup('group-1')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                    <i class="fas fa-trash mr-1"></i>
                                                    刪除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="ml-16">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                            <i class="fas fa-store text-yellow-600 mr-2"></i>
                                            攤位配置：
                                        </h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            <div class="p-4 border rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                                                <div class="flex justify-between items-start mb-3">
                                                    <div>
                                                        <span class="block font-bold text-gray-900">標準攤位</span>
                                                        <span class="block text-sm text-gray-500">3m x 3m</span>
                                                    </div>
                                                    <span class="text-xl font-bold text-yellow-600">NT$ 3,000</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-gray-500">可用數量</span>
                                                    <span class="font-bold text-gray-900">30 個</span>
                                                </div>
                                            </div>
                                            <div class="p-4 border rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                                                <div class="flex justify-between items-start mb-3">
                                                    <div>
                                                        <span class="block font-bold text-gray-900">大型攤位</span>
                                                        <span class="block text-sm text-gray-500">4m x 4m</span>
                                                    </div>
                                                    <span class="text-xl font-bold text-yellow-600">NT$ 4,500</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-gray-500">可用數量</span>
                                                    <span class="font-bold text-gray-900">15 個</span>
                                                </div>
                                            </div>
                                            <div class="p-4 border rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                                                <div class="flex justify-between items-start mb-3">
                                                    <div>
                                                        <span class="block font-bold text-gray-900">小型攤位</span>
                                                        <span class="block text-sm text-gray-500">2m x 2m</span>
                                                    </div>
                                                    <span class="text-xl font-bold text-yellow-600">NT$ 2,000</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-gray-500">可用數量</span>
                                                    <span class="font-bold text-gray-900">20 個</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 範例參加日期 2 -->
                                <div class="border border-gray-200 rounded-lg p-6 bg-gradient-to-r from-blue-50 to-purple-50">
                                    <div class="flex items-center justify-between mb-6">
                                        <div class="flex items-center">
                                            <div class="p-3 bg-blue-100 rounded-lg mr-4">
                                                <i class="fas fa-calendar-week text-blue-600 text-xl"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-xl font-bold text-gray-900">週末文創市集 - 第二週</h3>
                                                <p class="text-sm text-gray-600">活動日期：3/23（六）、3/24（日）</p>
                                                <p class="text-sm text-gray-500">時間：10:00 - 18:00</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-4">
                                            <div class="text-right">
                                                <div class="text-sm text-gray-500">總攤位數</div>
                                                <div class="font-bold text-lg text-gray-900">35</div>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <button type="button" onclick="editDateGroup('group-2')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                    <i class="fas fa-edit mr-1"></i>
                                                    編輯
                                                </button>
                                                <button type="button" onclick="deleteDateGroup('group-2')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                    <i class="fas fa-trash mr-1"></i>
                                                    刪除
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="ml-16">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                            <i class="fas fa-store text-blue-600 mr-2"></i>
                                            攤位配置：
                                        </h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            <div class="p-4 border rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                                                <div class="flex justify-between items-start mb-3">
                                                    <div>
                                                        <span class="block font-bold text-gray-900">標準攤位</span>
                                                        <span class="block text-sm text-gray-500">3m x 3m</span>
                                                    </div>
                                                    <span class="text-xl font-bold text-blue-600">NT$ 3,200</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-gray-500">可用數量</span>
                                                    <span class="font-bold text-gray-900">25 個</span>
                                                </div>
                                            </div>
                                            <div class="p-4 border rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                                                <div class="flex justify-between items-start mb-3">
                                                    <div>
                                                        <span class="block font-bold text-gray-900">大型攤位</span>
                                                        <span class="block text-sm text-gray-500">4m x 4m</span>
                                                    </div>
                                                    <span class="text-xl font-bold text-blue-600">NT$ 4,800</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-gray-500">可用數量</span>
                                                    <span class="font-bold text-gray-900">10 個</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 動態生成的參加日期項目會在這裡顯示 -->
                            </div>
                            
                            <!-- 分隔線 -->
                            <div class="border-t border-gray-200 pt-6 mt-8">
                                <h3 class="text-lg font-bold text-gray-900 mb-4">攤位類型設定</h3>
                                <p class="text-sm text-gray-600 mb-4">管理攤位類型的基本資訊，這些類型可以在日期配置中使用</p>
                                <div id="booth-list" class="space-y-3">
                                    <!-- 範例攤位類型 -->
                                    <div class="booth-item border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-4">
                                                <div class="p-2 bg-yellow-100 rounded-lg">
                                                    <i class="fas fa-store text-yellow-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-medium text-gray-900">標準攤位</h3>
                                                    <p class="text-sm text-gray-500">3m x 3m，適合一般商品展示</p>
                                                    <p class="text-xs text-gray-400 mt-1">編號：A-01 ~ A-50</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4">
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">基本價格</div>
                                                    <div class="font-medium text-gray-900">NT$ 3,000/天</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">總數量</div>
                                                    <div class="font-medium text-gray-900">50</div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <button type="button" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                        <i class="fas fa-edit mr-1"></i>
                                                        編輯
                                                    </button>
                                                    <button type="button" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                        <i class="fas fa-trash mr-1"></i>
                                                        刪除
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="booth-item border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-4">
                                                <div class="p-2 bg-yellow-100 rounded-lg">
                                                    <i class="fas fa-store text-yellow-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-medium text-gray-900">大型攤位</h3>
                                                    <p class="text-sm text-gray-500">4m x 4m，適合大型商品或多人攤位</p>
                                                    <p class="text-xs text-gray-400 mt-1">編號：B-01 ~ B-20</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4">
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">基本價格</div>
                                                    <div class="font-medium text-gray-900">NT$ 4,500/天</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">總數量</div>
                                                    <div class="font-medium text-gray-900">20</div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <button type="button" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                        <i class="fas fa-edit mr-1"></i>
                                                        編輯
                                                    </button>
                                                    <button type="button" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                        <i class="fas fa-trash mr-1"></i>
                                                        刪除
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="booth-item border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-4">
                                                <div class="p-2 bg-yellow-100 rounded-lg">
                                                    <i class="fas fa-store text-yellow-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-medium text-gray-900">小型攤位</h3>
                                                    <p class="text-sm text-gray-500">2m x 2m，適合小商品或初次參加者</p>
                                                    <p class="text-xs text-gray-400 mt-1">編號：C-01 ~ C-30</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4">
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">基本價格</div>
                                                    <div class="font-medium text-gray-900">NT$ 2,000/天</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">總數量</div>
                                                    <div class="font-medium text-gray-900">30</div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <button type="button" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                        <i class="fas fa-edit mr-1"></i>
                                                        編輯
                                                    </button>
                                                    <button type="button" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                        <i class="fas fa-trash mr-1"></i>
                                                        刪除
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 動態生成的攤位類型列表會在這裡顯示 -->
                                </div>
                            </div>
                        </div>

                        <!-- 租借設備 -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-lg font-bold text-gray-900">租借設備</h2>
                                <button type="button" onclick="openAddEquipmentModal()" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors">
                                    <i class="fas fa-plus mr-2"></i>
                                    新增設備
                                </button>
                            </div>
                            <div class="space-y-4">
                                <!-- 設備列表 -->
                                <div id="equipment-list" class="space-y-3">
                                    <!-- 陽傘 -->
                                    <div class="equipment-item" data-id="umbrella">
                                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                            <div class="flex items-center space-x-4">
                                                <div class="p-2 bg-yellow-100 rounded-lg">
                                                    <i class="fas fa-umbrella text-yellow-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-medium text-gray-900">陽傘</h3>
                                                    <p class="text-sm text-gray-500">遮陽防雨，適合戶外攤位</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4">
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">單價</div>
                                                    <div class="font-medium text-gray-900">NT$ 200/天</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">可租借數量</div>
                                                    <div class="font-medium text-gray-900">50</div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <button type="button" onclick="editEquipment('umbrella')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                        <i class="fas fa-edit mr-1"></i>
                                                        編輯
                                                    </button>
                                                    <button type="button" onclick="deleteEquipment('umbrella')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                        <i class="fas fa-trash mr-1"></i>
                                                        刪除
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 桌椅組 -->
                                    <div class="equipment-item" data-id="table">
                                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                            <div class="flex items-center space-x-4">
                                                <div class="p-2 bg-yellow-100 rounded-lg">
                                                    <i class="fas fa-chair text-yellow-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-medium text-gray-900">桌椅組</h3>
                                                    <p class="text-sm text-gray-500">一桌二椅，基本展示設備</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4">
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">單價</div>
                                                    <div class="font-medium text-gray-900">NT$ 300/天</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">可租借數量</div>
                                                    <div class="font-medium text-gray-900">30</div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <button type="button" onclick="editEquipment('table')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                        <i class="fas fa-edit mr-1"></i>
                                                        編輯
                                                    </button>
                                                    <button type="button" onclick="deleteEquipment('table')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                        <i class="fas fa-trash mr-1"></i>
                                                        刪除
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 電燈 -->
                                    <div class="equipment-item" data-id="light">
                                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                            <div class="flex items-center space-x-4">
                                                <div class="p-2 bg-yellow-100 rounded-lg">
                                                    <i class="fas fa-lightbulb text-yellow-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-medium text-gray-900">電燈</h3>
                                                    <p class="text-sm text-gray-500">LED 照明燈具，提供充足光源</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4">
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">單價</div>
                                                    <div class="font-medium text-gray-900">NT$ 150/天</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">可租借數量</div>
                                                    <div class="font-medium text-gray-900">40</div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <button type="button" onclick="editEquipment('light')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                        <i class="fas fa-edit mr-1"></i>
                                                        編輯
                                                    </button>
                                                    <button type="button" onclick="deleteEquipment('light')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                        <i class="fas fa-trash mr-1"></i>
                                                        刪除
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 電源插座 -->
                                    <div class="equipment-item" data-id="power">
                                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                            <div class="flex items-center space-x-4">
                                                <div class="p-2 bg-yellow-100 rounded-lg">
                                                    <i class="fas fa-plug text-yellow-600"></i>
                                                </div>
                                                <div>
                                                    <h3 class="font-medium text-gray-900">電源插座</h3>
                                                    <p class="text-sm text-gray-500">110V 電源，適合電器設備</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4">
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">單價</div>
                                                    <div class="font-medium text-gray-900">NT$ 100/天</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-sm text-gray-500">可租借數量</div>
                                                    <div class="font-medium text-gray-900">25</div>
                                                </div>
                                                <div class="flex items-center space-x-2">
                                                    <button type="button" onclick="editEquipment('power')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                                        <i class="fas fa-edit mr-1"></i>
                                                        編輯
                                                    </button>
                                                    <button type="button" onclick="deleteEquipment('power')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                                        <i class="fas fa-trash mr-1"></i>
                                                        刪除
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- 新增/編輯參加日期模態框 -->
                        <div id="date-group-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
                            <div class="flex items-center justify-center min-h-screen p-4">
                                <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                                    <div class="p-6">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="text-lg font-bold text-gray-900" id="date-group-modal-title">新增參加日期</h3>
                                            <button type="button" onclick="closeDateGroupModal()" class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        
                                        <form id="date-group-form" class="space-y-6">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">參加日期名稱</label>
                                                <input type="text" id="group-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="例如：週末文創市集 - 第一週" required>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-3">活動日期</label>
                                                <div id="date-inputs" class="space-y-3">
                                                    <!-- 動態生成的日期輸入 -->
                                                </div>
                                                <button type="button" onclick="addDateInput()" class="mt-2 px-3 py-1 text-sm bg-green-500 text-white rounded hover:bg-green-600">
                                                    <i class="fas fa-plus mr-1"></i>
                                                    新增日期
                                                </button>
                                            </div>
                                            
                                            <div class="grid grid-cols-3 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">開始時間</label>
                                                    <input type="time" id="group-start-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" required>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">結束時間</label>
                                                    <input type="time" id="group-end-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" required>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">剩餘名額</label>
                                                    <input type="number" id="group-quota" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" min="0" value="20" required>
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <div class="flex justify-between items-center mb-3">
                                                    <label class="block text-sm font-medium text-gray-700">攤位配置</label>
                                                    <button type="button" onclick="addBoothConfig()" class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600">
                                                        <i class="fas fa-plus mr-1"></i>
                                                        新增配置
                                                    </button>
                                                </div>
                                                <div id="booth-configs" class="space-y-4">
                                                    <!-- 動態生成的攤位配置 -->
                                                </div>
                                            </div>
                                            
                                            <div class="flex justify-end space-x-3 pt-4">
                                                <button type="button" onclick="closeDateGroupModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                                    取消
                                                </button>
                                                <button type="submit" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                                                    儲存
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 新增/編輯攤位模態框 -->
                        <div id="booth-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
                            <div class="flex items-center justify-center min-h-screen p-4">
                                <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                                    <div class="p-6">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="text-lg font-bold text-gray-900" id="booth-modal-title">新增攤位類型</h3>
                                            <button type="button" onclick="closeBoothModal()" class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        
                                        <form id="booth-form" class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">攤位類型名稱</label>
                                                <input type="text" id="booth-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="請輸入攤位類型名稱" required>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">攤位介紹</label>
                                                <textarea id="booth-description" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" rows="3" placeholder="請輸入攤位介紹" required></textarea>
                                            </div>
                                            
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">攤位尺寸</label>
                                                    <input type="text" id="booth-size" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="例如：3m x 3m" required>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">攤位編號前綴</label>
                                                    <input type="text" id="booth-prefix" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="例如：A" required>
                                                </div>
                                            </div>
                                            
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">單價 (NT$/天)</label>
                                                    <input type="number" id="booth-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="請輸入單價" min="0" required>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">攤位數量</label>
                                                    <input type="number" id="booth-quantity" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="請輸入攤位數量" min="1" required>
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">攤位圖標</label>
                                                <select id="booth-icon" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                                    <option value="fas fa-store">攤位</option>
                                                    <option value="fas fa-home">房屋</option>
                                                    <option value="fas fa-building">建築</option>
                                                    <option value="fas fa-warehouse">倉庫</option>
                                                    <option value="fas fa-shop">商店</option>
                                                    <option value="fas fa-cube">立方體</option>
                                                </select>
                                            </div>
                                            
                                            <div class="flex justify-end space-x-3 pt-4">
                                                <button type="button" onclick="closeBoothModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                                    取消
                                                </button>
                                                <button type="submit" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                                                    儲存
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 照片裁切模態框 -->
                        <div id="crop-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 backdrop-blur-sm overflow-y-auto">
                            <div class="flex items-center justify-center min-h-screen p-4 py-8">
                                <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full overflow-hidden my-auto">
                                    <!-- 標題區 -->
                                    <div class="bg-gradient-to-r from-yellow-400 via-orange-400 to-yellow-500 px-6 py-4">
                                        <div class="flex justify-between items-center">
                                            <div class="flex items-center space-x-3">
                                                <div class="bg-white bg-opacity-30 p-2 rounded-lg backdrop-blur-sm">
                                                    <i class="fas fa-cut text-white text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 class="text-xl font-bold text-white">裁切活動照片</h3>
                                                    <p class="text-sm text-white text-opacity-90">調整圖片以符合活動需求</p>
                                                </div>
                                            </div>
                                            <button type="button" onclick="closeCropModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-all">
                                                <i class="fas fa-times text-xl"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="p-4 space-y-4">
                                        <!-- 裁切預覽區 -->
                                        <div class="crop-preview">
                                            <div class="crop-preview-inner">
                                                <img id="crop-image" src="" alt="待裁切的圖片">
                                            </div>
                                        </div>

                                        <!-- 裁切工具列 -->
                                        <div class="bg-gray-50 rounded-xl p-3">
                                            <div class="flex items-center justify-start flex-wrap gap-2">
                                                <span class="text-xs font-semibold text-gray-600 mr-1">
                                                    <i class="fas fa-tools mr-1"></i>工具：
                                                </span>
                                                <button type="button" onclick="cropImage.zoom(0.1)" class="crop-tool-btn px-3 py-1.5 bg-white text-gray-700 rounded-lg shadow-sm hover:bg-blue-50 hover:text-blue-600 border border-gray-200 text-xs" title="放大">
                                                    <i class="fas fa-search-plus"></i>
                                                </button>
                                                <button type="button" onclick="cropImage.zoom(-0.1)" class="crop-tool-btn px-3 py-1.5 bg-white text-gray-700 rounded-lg shadow-sm hover:bg-blue-50 hover:text-blue-600 border border-gray-200 text-xs" title="縮小">
                                                    <i class="fas fa-search-minus"></i>
                                                </button>
                                                <button type="button" onclick="cropImage.rotate(-90)" class="crop-tool-btn px-3 py-1.5 bg-white text-gray-700 rounded-lg shadow-sm hover:bg-purple-50 hover:text-purple-600 border border-gray-200 text-xs" title="逆時針旋轉">
                                                    <i class="fas fa-undo"></i>
                                                </button>
                                                <button type="button" onclick="cropImage.rotate(90)" class="crop-tool-btn px-3 py-1.5 bg-white text-gray-700 rounded-lg shadow-sm hover:bg-purple-50 hover:text-purple-600 border border-gray-200 text-xs" title="順時針旋轉">
                                                    <i class="fas fa-redo"></i>
                                                </button>
                                                <button type="button" onclick="cropImage.scaleX(-cropImage.getData().scaleX || -1)" class="crop-tool-btn px-3 py-1.5 bg-white text-gray-700 rounded-lg shadow-sm hover:bg-green-50 hover:text-green-600 border border-gray-200 text-xs" title="水平翻轉">
                                                    <i class="fas fa-arrows-alt-h"></i>
                                                </button>
                                                <button type="button" onclick="cropImage.scaleY(-cropImage.getData().scaleY || -1)" class="crop-tool-btn px-3 py-1.5 bg-white text-gray-700 rounded-lg shadow-sm hover:bg-green-50 hover:text-green-600 border border-gray-200 text-xs" title="垂直翻轉">
                                                    <i class="fas fa-arrows-alt-v"></i>
                                                </button>
                                                <button type="button" onclick="cropImage.reset()" class="crop-tool-btn px-3 py-1.5 bg-white text-gray-700 rounded-lg shadow-sm hover:bg-red-50 hover:text-red-600 border border-gray-200 text-xs" title="重置">
                                                    <i class="fas fa-sync-alt"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- 裁切比例選擇 -->
                                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-4 border border-yellow-200">
                                            <div class="flex items-center flex-wrap gap-3">
                                                <div class="flex items-center space-x-2 mr-2">
                                                    <div class="bg-yellow-500 p-2 rounded-lg">
                                                        <i class="fas fa-crop-alt text-white"></i>
                                                    </div>
                                                    <span class="text-sm font-semibold text-gray-700">裁切比例：</span>
                                                </div>
                                                <button type="button" onclick="setAspectRatio(0)" class="aspect-ratio-btn px-4 py-2 text-sm font-medium bg-white text-gray-700 rounded-lg">
                                                    <i class="fas fa-expand-arrows-alt mr-1"></i>自由
                                                </button>
                                                <button type="button" onclick="setAspectRatio(2/1)" class="aspect-ratio-btn active px-4 py-2 text-sm font-medium rounded-lg">
                                                    <i class="fas fa-star mr-1"></i>2:1
                                                    <span class="ml-1 text-xs opacity-90">(推薦)</span>
                                                </button>
                                                <button type="button" onclick="setAspectRatio(16/9)" class="aspect-ratio-btn px-4 py-2 text-sm font-medium bg-white text-gray-700 rounded-lg">
                                                    <i class="fas fa-tv mr-1"></i>16:9
                                                </button>
                                                <button type="button" onclick="setAspectRatio(4/3)" class="aspect-ratio-btn px-4 py-2 text-sm font-medium bg-white text-gray-700 rounded-lg">
                                                    <i class="fas fa-image mr-1"></i>4:3
                                                </button>
                                                <button type="button" onclick="setAspectRatio(1)" class="aspect-ratio-btn px-4 py-2 text-sm font-medium bg-white text-gray-700 rounded-lg">
                                                    <i class="fas fa-square mr-1"></i>1:1
                                                </button>
                                            </div>
                                        </div>

                                        <!-- 提示訊息 -->
                                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-start space-x-3">
                                            <i class="fas fa-info-circle text-blue-500 mt-1"></i>
                                            <div class="text-sm text-blue-700">
                                                <p class="font-medium">使用提示：</p>
                                                <ul class="mt-1 space-y-1 text-xs">
                                                    <li>• 拖曳圖片或裁切框來調整位置</li>
                                                    <li>• 滾動滑鼠滾輪可以縮放圖片</li>
                                                    <li>• 建議使用 2:1 比例以獲得最佳顯示效果</li>
                                                </ul>
                                            </div>
                                        </div>

                                        <!-- 按鈕區 -->
                                        <div class="flex justify-between items-center pt-2 border-t border-gray-200">
                                            <button type="button" onclick="closeCropModal()" class="px-6 py-3 border-2 border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition-all hover:border-gray-400">
                                                <i class="fas fa-times mr-2"></i>取消
                                            </button>
                                            <button type="button" onclick="applyCrop()" class="px-8 py-3 bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-xl hover:from-yellow-500 hover:to-orange-600 font-bold shadow-lg hover:shadow-xl transition-all transform hover:scale-105">
                                                <i class="fas fa-check-circle mr-2"></i>確認裁切
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 新增/編輯設備模態框 -->
                        <div id="equipment-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
                            <div class="flex items-center justify-center min-h-screen p-4">
                                <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                                    <div class="p-6">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="text-lg font-bold text-gray-900" id="modal-title">新增設備</h3>
                                            <button type="button" onclick="closeEquipmentModal()" class="text-gray-400 hover:text-gray-600">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        
                                        <form id="equipment-form" class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">設備名稱</label>
                                                <input type="text" id="equipment-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="請輸入設備名稱" required>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">設備介紹</label>
                                                <textarea id="equipment-description" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" rows="3" placeholder="請輸入設備介紹" required></textarea>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">單價 (NT$/天)</label>
                                                <input type="number" id="equipment-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="請輸入單價" min="0" required>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">可租借數量</label>
                                                <input type="number" id="equipment-quantity" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" placeholder="請輸入可租借數量" min="1" required>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">設備圖標</label>
                                                <select id="equipment-icon" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                                    <option value="fas fa-umbrella">陽傘</option>
                                                    <option value="fas fa-chair">桌椅</option>
                                                    <option value="fas fa-plug">電源</option>
                                                    <option value="fas fa-layer-group">展示架</option>
                                                    <option value="fas fa-volume-up">音響</option>
                                                    <option value="fas fa-lightbulb">燈具</option>
                                                    <option value="fas fa-fan">風扇</option>
                                                    <option value="fas fa-thermometer-half">空調</option>
                                                    <option value="fas fa-tv">螢幕</option>
                                                    <option value="fas fa-camera">攝影</option>
                                                </select>
                                            </div>
                                            
                                            <div class="flex justify-end space-x-3 pt-4">
                                                <button type="button" onclick="closeEquipmentModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                                    取消
                                                </button>
                                                <button type="submit" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                                                    儲存
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 場地須知 -->
                        <div class="bg-white rounded-lg shadow-sm p-6 mt-8">
                            <h2 class="text-lg font-bold text-gray-900 mb-4">場地須知</h2>
                            <p class="text-sm text-gray-500 mb-4">開啟項目後，攤商在活動頁面將會看到對應的場地說明</p>
                            <div class="space-y-4">

                                <!-- 攤位設備 -->
                                <div class="venue-item border border-gray-200 rounded-lg p-4" id="venue-booth-equipment">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center space-x-3">
                                            <label class="toggle-switch">
                                                <input type="checkbox" checked onchange="toggleVenueItem('venue-booth-equipment', this.checked)">
                                                <span class="toggle-slider"></span>
                                            </label>
                                            <div class="p-2 bg-yellow-100 rounded-lg">
                                                <i class="fas fa-ruler text-yellow-600"></i>
                                            </div>
                                            <h3 class="font-medium text-gray-900">攤位設備</h3>
                                        </div>
                                    </div>
                                    <div class="venue-desc ml-14">
                                        <textarea rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 text-sm">提供桌椅、遮陽棚</textarea>
                                    </div>
                                </div>

                                <!-- 供電服務 -->
                                <div class="venue-item border border-gray-200 rounded-lg p-4 opacity-50" id="venue-power">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center space-x-3">
                                            <label class="toggle-switch">
                                                <input type="checkbox" onchange="toggleVenueItem('venue-power', this.checked)">
                                                <span class="toggle-slider"></span>
                                            </label>
                                            <div class="p-2 bg-yellow-100 rounded-lg">
                                                <i class="fas fa-bolt text-yellow-600"></i>
                                            </div>
                                            <h3 class="font-medium text-gray-900">供電服務</h3>
                                        </div>
                                    </div>
                                    <div class="venue-desc ml-14">
                                        <textarea rows="2" disabled class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 text-sm bg-gray-50">每個攤位提供110V/500W電力，如需額外用電請事先申請</textarea>
                                    </div>
                                </div>

                                <!-- 電器與用電登記 -->
                                <div class="venue-item border border-gray-200 rounded-lg p-4 opacity-50" id="venue-appliance">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center space-x-3">
                                            <label class="toggle-switch">
                                                <input type="checkbox" onchange="toggleVenueItem('venue-appliance', this.checked)">
                                                <span class="toggle-slider"></span>
                                            </label>
                                            <div class="p-2 bg-yellow-100 rounded-lg">
                                                <i class="fas fa-plug text-yellow-600"></i>
                                            </div>
                                            <h3 class="font-medium text-gray-900">電器與用電登記</h3>
                                        </div>
                                    </div>
                                    <div class="venue-desc ml-14">
                                        <textarea rows="2" disabled class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 text-sm bg-gray-50">請攤商於報名時填寫使用的電器設備及預估用電瓦數（W），以利場地用電規劃</textarea>
                                    </div>
                                </div>

                                <!-- 明火使用 -->
                                <div class="venue-item border border-gray-200 rounded-lg p-4" id="venue-fire">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center space-x-3">
                                            <label class="toggle-switch">
                                                <input type="checkbox" checked onchange="toggleVenueItem('venue-fire', this.checked)">
                                                <span class="toggle-slider"></span>
                                            </label>
                                            <div class="p-2 bg-yellow-100 rounded-lg">
                                                <i class="fas fa-fire text-yellow-600"></i>
                                            </div>
                                            <h3 class="font-medium text-gray-900">明火使用</h3>
                                        </div>
                                    </div>
                                    <div class="venue-desc ml-14">
                                        <textarea rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 text-sm">禁止使用明火及瓦斯等危險物品</textarea>
                                    </div>
                                </div>

                                <!-- 寄物服務 -->
                                <div class="venue-item border border-gray-200 rounded-lg p-4 opacity-50" id="venue-storage">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center space-x-3">
                                            <label class="toggle-switch">
                                                <input type="checkbox" onchange="toggleVenueItem('venue-storage', this.checked)">
                                                <span class="toggle-slider"></span>
                                            </label>
                                            <div class="p-2 bg-yellow-100 rounded-lg">
                                                <i class="fas fa-box text-yellow-600"></i>
                                            </div>
                                            <h3 class="font-medium text-gray-900">寄物服務</h3>
                                        </div>
                                    </div>
                                    <div class="venue-desc ml-14">
                                        <textarea rows="2" disabled class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 text-sm bg-gray-50">不提供寄物服務，請自行保管貴重物品</textarea>
                                    </div>
                                </div>

                                <!-- 垃圾處理 -->
                                <div class="venue-item border border-gray-200 rounded-lg p-4" id="venue-trash">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center space-x-3">
                                            <label class="toggle-switch">
                                                <input type="checkbox" checked onchange="toggleVenueItem('venue-trash', this.checked)">
                                                <span class="toggle-slider"></span>
                                            </label>
                                            <div class="p-2 bg-yellow-100 rounded-lg">
                                                <i class="fas fa-trash text-yellow-600"></i>
                                            </div>
                                            <h3 class="font-medium text-gray-900">垃圾處理</h3>
                                        </div>
                                    </div>
                                    <div class="venue-desc ml-14">
                                        <textarea rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 text-sm">請自行處理垃圾，保持攤位整潔</textarea>
                                    </div>
                                </div>

                                <!-- 車輛進場登記 -->
                                <div class="venue-item border border-gray-200 rounded-lg p-4 opacity-50" id="venue-car">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center space-x-3">
                                            <label class="toggle-switch">
                                                <input type="checkbox" onchange="toggleVenueItem('venue-car', this.checked)">
                                                <span class="toggle-slider"></span>
                                            </label>
                                            <div class="p-2 bg-yellow-100 rounded-lg">
                                                <i class="fas fa-car text-yellow-600"></i>
                                            </div>
                                            <h3 class="font-medium text-gray-900">車輛進場登記</h3>
                                        </div>
                                    </div>
                                    <div class="venue-desc ml-14">
                                        <textarea rows="2" disabled class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 text-sm bg-gray-50">需於報名時提供車牌號碼，未登記車輛無法進入場地裝卸貨區域</textarea>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- 報名設定 -->
                        <div class="bg-white rounded-lg shadow-sm p-6 mt-8">
                            <h2 class="text-lg font-bold text-gray-900 mb-4">報名設定</h2>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">報名開始時間</label>
                                    <input type="datetime-local" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="2024-02-16T10:00">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">報名截止時間</label>
                                    <input type="datetime-local" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="2024-03-01T23:59">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">審核截止時間</label>
                                    <input type="datetime-local" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="2024-03-05T23:59">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">匯款截止時間</label>
                                    <input type="datetime-local" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="2024-03-08T23:59">
                                </div>
                            </div>
                        </div>

                        <!-- 提交按鈕 -->
                        <div class="flex justify-between space-x-4">
                            <button type="button" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                <i class="fas fa-trash-alt mr-2"></i>
                                刪除活動
                            </button>
                            <div class="flex space-x-4">
                                <button type="button" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                    取消
                                </button>
                                <button type="submit" class="px-6 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                                    儲存變更
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <!-- Cropper.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>

    <!-- JavaScript -->
    <script>
        // 場地須知 toggle
        function toggleVenueItem(id, enabled) {
            const item = document.getElementById(id);
            const textarea = item.querySelector('textarea');
            if (enabled) {
                item.classList.remove('opacity-50');
                textarea.disabled = false;
                textarea.classList.remove('bg-gray-50');
            } else {
                item.classList.add('opacity-50');
                textarea.disabled = true;
                textarea.classList.add('bg-gray-50');
            }
        }

        // 參加日期資料存儲
        let dateGroupData = {
            'group-1': {
                id: 'group-1',
                name: '週末文創市集 - 第一週',
                dates: ['2024-03-16', '2024-03-17'],
                startTime: '10:00',
                endTime: '18:00',
                remainingQuota: 65, // 30 + 15 + 20 = 65
                boothConfigs: [
                    {
                        id: 'config-1',
                        boothType: 'standard',
                        quantity: 30,
                        price: 3000
                    },
                    {
                        id: 'config-2',
                        boothType: 'large',
                        quantity: 15,
                        price: 4500
                    },
                    {
                        id: 'config-3',
                        boothType: 'small',
                        quantity: 20,
                        price: 2000
                    }
                ]
            },
            'group-2': {
                id: 'group-2',
                name: '週末文創市集 - 第二週',
                dates: ['2024-03-23', '2024-03-24'],
                startTime: '10:00',
                endTime: '18:00',
                remainingQuota: 35, // 25 + 10 = 35
                boothConfigs: [
                    {
                        id: 'config-4',
                        boothType: 'standard',
                        quantity: 25,
                        price: 3200
                    },
                    {
                        id: 'config-5',
                        boothType: 'large',
                        quantity: 10,
                        price: 4800
                    }
                ]
            }
        };

        // 攤位資料存儲
        let boothData = {
            standard: {
                id: 'standard',
                name: '標準攤位',
                description: '3m x 3m，適合一般商品展示',
                size: '3m x 3m',
                prefix: 'A',
                price: 3000,
                quantity: 50,
                icon: 'fas fa-store'
            },
            large: {
                id: 'large',
                name: '大型攤位',
                description: '4m x 4m，適合大型商品或多人攤位',
                size: '4m x 4m',
                prefix: 'B',
                price: 4500,
                quantity: 20,
                icon: 'fas fa-store'
            },
            small: {
                id: 'small',
                name: '小型攤位',
                description: '2m x 2m，適合小商品或初次參加者',
                size: '2m x 2m',
                prefix: 'C',
                price: 2000,
                quantity: 30,
                icon: 'fas fa-store'
            }
        };

        // 設備資料存儲
        let equipmentData = {
            umbrella: {
                id: 'umbrella',
                name: '陽傘',
                description: '遮陽防雨，適合戶外攤位',
                price: 200,
                quantity: 50,
                icon: 'fas fa-umbrella'
            },
            table: {
                id: 'table',
                name: '桌椅組',
                description: '一桌二椅，基本展示設備',
                price: 300,
                quantity: 30,
                icon: 'fas fa-chair'
            },
            light: {
                id: 'light',
                name: '電燈',
                description: 'LED 照明燈具，提供充足光源',
                price: 150,
                quantity: 40,
                icon: 'fas fa-lightbulb'
            },
            power: {
                id: 'power',
                name: '電源插座',
                description: '110V 電源，適合電器設備',
                price: 100,
                quantity: 25,
                icon: 'fas fa-plug'
            }
        };

        let editingDateGroupId = null;
        let editingBoothId = null;
        let editingEquipmentId = null;

        // 參加日期相關函數
        let configCounter = 0;
        let dateInputCounter = 0;
        
        // 開啟新增參加日期模態框
        function openAddDateGroupModal() {
            editingDateGroupId = null;
            document.getElementById('date-group-modal-title').textContent = '新增參加日期';
            // document.getElementById('date-group-form').reset();
            clearDateInputs();
            clearBoothConfigs();
            addDateInput(); // 預設新增一個日期輸入
            addBoothConfig(); // 預設新增一個攤位配置
            setTimeout(() => {
                updateQuotaDisplay(); // 更新剩餘名額顯示
            }, 100);
            document.getElementById('date-group-modal').classList.remove('hidden');
        }

        // 開啟編輯參加日期模態框
        function editDateGroup(groupId) {
            editingDateGroupId = groupId;
            const group = dateGroupData[groupId];
            
            document.getElementById('date-group-modal-title').textContent = '編輯參加日期';
            document.getElementById('group-name').value = group.name;
            document.getElementById('group-start-time').value = group.startTime;
            document.getElementById('group-end-time').value = group.endTime;
            document.getElementById('group-quota').value = group.remainingQuota;
            
            clearDateInputs();
            clearBoothConfigs();
            
            // 載入現有的日期
            group.dates.forEach(date => {
                addDateInput(date);
            });
            
            // 載入現有的攤位配置
            group.boothConfigs.forEach(config => {
                addBoothConfig(config);
            });
            
            setTimeout(() => {
                updateQuotaDisplay(); // 更新剩餘名額顯示
            }, 100);
            
            document.getElementById('date-group-modal').classList.remove('hidden');
        }

        // 關閉參加日期模態框
        function closeDateGroupModal() {
            document.getElementById('date-group-modal').classList.add('hidden');
            editingDateGroupId = null;
        }

        // 刪除參加日期
        function deleteDateGroup(groupId) {
            if (confirm('確定要刪除此參加日期嗎？')) {
                delete dateGroupData[groupId];
                renderDateGroupList();
            }
        }

        // 新增攤位配置
        function addBoothConfig(config = null) {
            const container = document.getElementById('booth-configs');
            configCounter++;
            
            const configId = config ? config.id : `config-${configCounter}-${Date.now()}`;
            const boothType = config ? config.boothType : '';
            const quantity = config ? config.quantity : 10;
            const price = config ? config.price : 3000;
            
            const configDiv = document.createElement('div');
            configDiv.className = 'border border-gray-200 rounded-lg p-4 bg-gray-50';
            configDiv.setAttribute('data-config-id', configId);
            
            configDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="text-sm font-medium text-gray-700">攤位配置</h4>
                    <button type="button" onclick="removeBoothConfig('${configId}')" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">攤位類型</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" required>
                            <option value="">請選擇攤位類型</option>
                            ${Object.values(boothData).map(booth => 
                                `<option value="${booth.id}" ${booth.id === boothType ? 'selected' : ''}>${booth.name} (${booth.size})</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">數量</label>
                        <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" min="1" value="${quantity}" onchange="updateQuotaDisplay()" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">價格 (NT$/天)</label>
                        <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" min="0" value="${price}" required>
                    </div>
                </div>
            `;
            
            container.appendChild(configDiv);
        }

        // 移除攤位配置
        function removeBoothConfig(configId) {
            const configDiv = document.querySelector(`[data-config-id="${configId}"]`);
            if (configDiv) {
                configDiv.remove();
                updateQuotaDisplay(); // 更新剩餘名額
            }
        }

        // 清除所有攤位配置
        function clearBoothConfigs() {
            document.getElementById('booth-configs').innerHTML = '';
        }

        // 新增日期輸入
        function addDateInput(date = '') {
            const container = document.getElementById('date-inputs');
            dateInputCounter++;
            
            const dateDiv = document.createElement('div');
            dateDiv.className = 'flex items-center space-x-3';
            dateDiv.setAttribute('data-date-input', dateInputCounter);
            
            dateDiv.innerHTML = `
                <input type="date" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500" value="${date}" required>
                <button type="button" onclick="removeDateInput('${dateInputCounter}')" class="text-red-500 hover:text-red-700">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            
            container.appendChild(dateDiv);
        }

        // 移除日期輸入
        function removeDateInput(inputId) {
            const dateDiv = document.querySelector(`[data-date-input="${inputId}"]`);
            if (dateDiv) {
                dateDiv.remove();
            }
        }

        // 清除所有日期輸入
        function clearDateInputs() {
            document.getElementById('date-inputs').innerHTML = '';
        }

        // 計算攤位配置總數量
        function calculateTotalQuota() {
            const configElements = document.querySelectorAll('#booth-configs [data-config-id]');
            let total = 0;
            
            configElements.forEach(configDiv => {
                const quantityInput = configDiv.querySelector('input[type="number"]:nth-of-type(1)');
                if (quantityInput && quantityInput.value) {
                    total += parseInt(quantityInput.value) || 0;
                }
            });
            
            return total;
        }

        // 更新剩餘名額顯示
        function updateQuotaDisplay() {
            const total = calculateTotalQuota();
            const quotaInput = document.getElementById('group-quota');
            if (quotaInput) {
                quotaInput.value = total;
            }
        }

        // 渲染參加日期列表
        function renderDateGroupList() {
            const container = document.getElementById('date-group-list');
            container.innerHTML = '';

            Object.values(dateGroupData).forEach(group => {
                const groupItem = document.createElement('div');
                groupItem.className = 'border border-gray-200 rounded-lg p-6 bg-gradient-to-r from-yellow-50 to-orange-50';
                groupItem.setAttribute('data-id', group.id);
                
                // 格式化日期顯示
                const formattedDates = group.dates.map(date => {
                    const dateObj = new Date(date);
                    const dayOfWeek = ['日', '一', '二', '三', '四', '五', '六'][dateObj.getDay()];
                    return `${date.split('-')[1]}/${date.split('-')[2]}（${dayOfWeek}）`;
                }).join('、');
                
                // 計算攤位總數量
                const totalBooths = group.boothConfigs.reduce((sum, config) => sum + config.quantity, 0);
                
                groupItem.innerHTML = `
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-lg mr-4">
                                <i class="fas fa-calendar-week text-yellow-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">${group.name}</h3>
                                <p class="text-sm text-gray-600">活動日期：${formattedDates}</p>
                                <p class="text-sm text-gray-500">時間：${group.startTime} - ${group.endTime}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-right">
                                <div class="text-sm text-gray-500">總攤位數</div>
                                <div class="font-bold text-lg text-gray-900">${totalBooths}</div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button type="button" onclick="editDateGroup('${group.id}')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                    <i class="fas fa-edit mr-1"></i>
                                    編輯
                                </button>
                                <button type="button" onclick="deleteDateGroup('${group.id}')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                    <i class="fas fa-trash mr-1"></i>
                                    刪除
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ml-16">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-store text-yellow-600 mr-2"></i>
                            攤位配置：
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${group.boothConfigs.map(config => {
                                const booth = boothData[config.boothType];
                                return `
                                    <div class="p-4 border rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <span class="block font-bold text-gray-900">${booth.name}</span>
                                                <span class="block text-sm text-gray-500">${booth.size}</span>
                                            </div>
                                            <span class="text-xl font-bold text-yellow-600">NT$ ${config.price.toLocaleString()}</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-500">可用數量</span>
                                            <span class="font-bold text-gray-900">${config.quantity} 個</span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
                
                container.appendChild(groupItem);
            });
        }


        // 攤位相關函數
        // 開啟新增攤位模態框
        function openAddBoothModal() {
            editingBoothId = null;
            document.getElementById('booth-modal-title').textContent = '新增攤位類型';
            document.getElementById('booth-form').reset();
            document.getElementById('booth-modal').classList.remove('hidden');
        }

        // 開啟編輯攤位模態框
        function editBooth(boothId) {
            editingBoothId = boothId;
            const booth = boothData[boothId];
            
            document.getElementById('booth-modal-title').textContent = '編輯攤位類型';
            document.getElementById('booth-name').value = booth.name;
            document.getElementById('booth-description').value = booth.description;
            document.getElementById('booth-size').value = booth.size;
            document.getElementById('booth-prefix').value = booth.prefix;
            document.getElementById('booth-price').value = booth.price;
            document.getElementById('booth-quantity').value = booth.quantity;
            document.getElementById('booth-icon').value = booth.icon;
            
            document.getElementById('booth-modal').classList.remove('hidden');
        }

        // 關閉攤位模態框
        function closeBoothModal() {
            document.getElementById('booth-modal').classList.add('hidden');
            editingBoothId = null;
        }

        // 刪除攤位
        function deleteBooth(boothId) {
            if (confirm('確定要刪除此攤位類型嗎？')) {
                delete boothData[boothId];
                renderBoothList();
            }
        }

        // 渲染攤位列表
        function renderBoothList() {
            const boothList = document.getElementById('booth-list');
            boothList.innerHTML = '';

            Object.values(boothData).forEach(booth => {
                const boothItem = document.createElement('div');
                boothItem.className = 'booth-item';
                boothItem.setAttribute('data-id', booth.id);
                
                boothItem.innerHTML = `
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <div class="p-2 bg-yellow-100 rounded-lg">
                                <i class="${booth.icon} text-yellow-600"></i>
                            </div>
                            <div>
                                <h3 class="font-medium text-gray-900">${booth.name}</h3>
                                <p class="text-sm text-gray-500">${booth.description}</p>
                                <p class="text-xs text-gray-400 mt-1">編號：${booth.prefix}-01 ~ ${booth.prefix}-${booth.quantity.toString().padStart(2, '0')}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-right">
                                <div class="text-sm text-gray-500">單價</div>
                                <div class="font-medium text-gray-900">NT$ ${booth.price.toLocaleString()}/天</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-500">攤位數量</div>
                                <div class="font-medium text-gray-900">${booth.quantity}</div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button type="button" onclick="editBooth('${booth.id}')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                    <i class="fas fa-edit mr-1"></i>
                                    編輯
                                </button>
                                <button type="button" onclick="deleteBooth('${booth.id}')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                    <i class="fas fa-trash mr-1"></i>
                                    刪除
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                boothList.appendChild(boothItem);
            });
        }


        // 開啟新增設備模態框
        function openAddEquipmentModal() {
            editingEquipmentId = null;
            document.getElementById('modal-title').textContent = '新增設備';
            document.getElementById('equipment-form').reset();
            document.getElementById('equipment-modal').classList.remove('hidden');
        }

        // 開啟編輯設備模態框
        function editEquipment(equipmentId) {
            editingEquipmentId = equipmentId;
            const equipment = equipmentData[equipmentId];
            
            document.getElementById('modal-title').textContent = '編輯設備';
            document.getElementById('equipment-name').value = equipment.name;
            document.getElementById('equipment-description').value = equipment.description;
            document.getElementById('equipment-price').value = equipment.price;
            document.getElementById('equipment-quantity').value = equipment.quantity;
            document.getElementById('equipment-icon').value = equipment.icon;
            
            document.getElementById('equipment-modal').classList.remove('hidden');
        }

        // 關閉設備模態框
        function closeEquipmentModal() {
            document.getElementById('equipment-modal').classList.add('hidden');
            editingEquipmentId = null;
        }

        // 刪除設備
        function deleteEquipment(equipmentId) {
            if (confirm('確定要刪除此設備嗎？')) {
                delete equipmentData[equipmentId];
                renderEquipmentList();
            }
        }

        // 渲染設備列表
        function renderEquipmentList() {
            console.log('開始渲染設備列表，設備資料：', equipmentData);
            const equipmentList = document.getElementById('equipment-list');
            console.log('找到設備列表容器：', equipmentList);
            equipmentList.innerHTML = '';

            Object.values(equipmentData).forEach(equipment => {
                console.log('正在渲染設備：', equipment);
                const equipmentItem = document.createElement('div');
                equipmentItem.className = 'equipment-item';
                equipmentItem.setAttribute('data-id', equipment.id);
                
                equipmentItem.innerHTML = `
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <div class="p-2 bg-yellow-100 rounded-lg">
                                <i class="${equipment.icon} text-yellow-600"></i>
                            </div>
                            <div>
                                <h3 class="font-medium text-gray-900">${equipment.name}</h3>
                                <p class="text-sm text-gray-500">${equipment.description}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-right">
                                <div class="text-sm text-gray-500">單價</div>
                                <div class="font-medium text-gray-900">NT$ ${equipment.price}/天</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-500">可租借數量</div>
                                <div class="font-medium text-gray-900">${equipment.quantity}</div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button type="button" onclick="editEquipment('${equipment.id}')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                    <i class="fas fa-edit mr-1"></i>
                                    編輯
                                </button>
                                <button type="button" onclick="deleteEquipment('${equipment.id}')" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">
                                    <i class="fas fa-trash mr-1"></i>
                                    刪除
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                equipmentList.appendChild(equipmentItem);
            });
        }

        // 生成唯一ID
        function generateId() {
            return 'equipment_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }


        // 照片裁切相關變數和函數
        let cropImage = null;
        let currentImageFile = null;

        // 開啟裁切模態框
        function openCropModal() {
            document.getElementById('crop-modal').classList.remove('hidden');

            // 等待圖片載入後再初始化 Cropper
            setTimeout(function() {
                const imageElement = document.getElementById('crop-image');

                // 如果已有 cropper 實例，先銷毀
                if (cropImage) {
                    cropImage.destroy();
                }

                // 建立新的 cropper 實例
                cropImage = new Cropper(imageElement, {
                    aspectRatio: 2 / 1, // 預設 2:1 比例
                    viewMode: 1,
                    dragMode: 'move',
                    autoCropArea: 1,
                    restore: false,
                    guides: true,
                    center: true,
                    highlight: true,
                    cropBoxMovable: true,
                    cropBoxResizable: true,
                    toggleDragModeOnDblclick: false,
                });
            }, 100);
        }

        // 關閉裁切模態框
        function closeCropModal() {
            document.getElementById('crop-modal').classList.add('hidden');

            // 銷毀 cropper 實例
            if (cropImage) {
                cropImage.destroy();
                cropImage = null;
            }

            // 清空檔案選擇
            document.getElementById('image-input').value = '';
        }

        // 設定裁切比例
        function setAspectRatio(ratio) {
            if (cropImage) {
                cropImage.setAspectRatio(ratio);

                // 更新按鈕的 active 狀態
                const buttons = document.querySelectorAll('.aspect-ratio-btn');
                buttons.forEach(btn => {
                    btn.classList.remove('active');
                });

                // 找到並標記當前按鈕為 active
                event.target.classList.add('active');
            }
        }

        // 確認裁切
        function applyCrop() {
            if (!cropImage) return;

            // 取得裁切後的 canvas
            const canvas = cropImage.getCroppedCanvas({
                maxWidth: 1200,
                maxHeight: 600,
                fillColor: '#fff',
                imageSmoothingEnabled: true,
                imageSmoothingQuality: 'high',
            });

            // 將 canvas 轉為 blob
            canvas.toBlob(function(blob) {
                // 建立新的 File 物件
                const croppedFile = new File([blob], currentImageFile.name, {
                    type: currentImageFile.type,
                    lastModified: Date.now(),
                });

                // 顯示裁切後的圖片
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('activity-image').src = e.target.result;
                };
                reader.readAsDataURL(croppedFile);

                // 這裡可以將 croppedFile 上傳到伺服器
                console.log('裁切後的檔案:', croppedFile);

                // 關閉模態框
                closeCropModal();
            }, currentImageFile.type);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderDateGroupList();
            renderBoothList();
            renderEquipmentList();

            // 監聽檔案選擇
            const imageInput = document.getElementById('image-input');
            if (imageInput) {
                imageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];

                    if (!file) return;

                    // 檢查檔案大小 (2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        alert('檔案大小不能超過 2MB');
                        e.target.value = '';
                        return;
                    }

                    // 檢查檔案類型
                    if (!file.type.match('image.*')) {
                        alert('請選擇圖片檔案');
                        e.target.value = '';
                        return;
                    }

                    currentImageFile = file;

                    // 讀取圖片
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const imageElement = document.getElementById('crop-image');
                        imageElement.src = event.target.result;

                        // 開啟裁切模態框
                        openCropModal();
                    };
                    reader.readAsDataURL(file);
                });
            }

            // 處理參加日期表單提交
            const dateGroupForm = document.getElementById('date-group-form');
            if (dateGroupForm) {
                dateGroupForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    const name = document.getElementById('group-name').value;
                    const startTime = document.getElementById('group-start-time').value;
                    const endTime = document.getElementById('group-end-time').value;
                    const quota = calculateTotalQuota();

                    const dateInputs = document.querySelectorAll('#date-inputs input[type="date"]');
                    const dates = Array.from(dateInputs).map(input => input.value).filter(date => date);

                    if (dates.length === 0) {
                        alert('請至少新增一個活動日期');
                        return;
                    }

                    const configElements = document.querySelectorAll('#booth-configs [data-config-id]');
                    const boothConfigs = [];

                    configElements.forEach(configDiv => {
                        const select = configDiv.querySelector('select');
                        const quantityInput = configDiv.querySelector('input[type="number"]:nth-of-type(1)');
                        const priceInput = configDiv.querySelector('input[type="number"]:nth-of-type(2)');

                        if (select.value && quantityInput.value && priceInput.value) {
                            boothConfigs.push({
                                id: configDiv.getAttribute('data-config-id'),
                                boothType: select.value,
                                quantity: parseInt(quantityInput.value),
                                price: parseInt(priceInput.value)
                            });
                        }
                    });

                    if (boothConfigs.length === 0) {
                        alert('請至少新增一個攤位配置');
                        return;
                    }

                    if (editingDateGroupId) {
                        dateGroupData[editingDateGroupId] = {
                            ...dateGroupData[editingDateGroupId],
                            name,
                            dates,
                            startTime,
                            endTime,
                            remainingQuota: quota,
                            boothConfigs
                        };
                    } else {
                        const newId = 'group-' + Date.now();
                        dateGroupData[newId] = {
                            id: newId,
                            name,
                            dates,
                            startTime,
                            endTime,
                            remainingQuota: quota,
                            boothConfigs
                        };
                    }

                    renderDateGroupList();
                    closeDateGroupModal();
                });
            }

            // 點擊參加日期模態框背景關閉
            const dateGroupModal = document.getElementById('date-group-modal');
            if (dateGroupModal) {
                dateGroupModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeDateGroupModal();
                    }
                });
            }

            // 處理攤位表單提交
            const boothForm = document.getElementById('booth-form');
            if (boothForm) {
                boothForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    const name = document.getElementById('booth-name').value;
                    const description = document.getElementById('booth-description').value;
                    const size = document.getElementById('booth-size').value;
                    const prefix = document.getElementById('booth-prefix').value;
                    const price = parseInt(document.getElementById('booth-price').value);
                    const quantity = parseInt(document.getElementById('booth-quantity').value);
                    const icon = document.getElementById('booth-icon').value;

                    if (editingBoothId) {
                        boothData[editingBoothId] = {
                            ...boothData[editingBoothId],
                            name,
                            description,
                            size,
                            prefix,
                            price,
                            quantity,
                            icon
                        };
                    } else {
                        const newId = 'booth_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        boothData[newId] = {
                            id: newId,
                            name,
                            description,
                            size,
                            prefix,
                            price,
                            quantity,
                            icon
                        };
                    }

                    renderBoothList();
                    closeBoothModal();
                });
            }

            // 點擊攤位模態框背景關閉
            const boothModal = document.getElementById('booth-modal');
            if (boothModal) {
                boothModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeBoothModal();
                    }
                });
            }

            // 處理設備表單提交
            const equipmentForm = document.getElementById('equipment-form');
            if (equipmentForm) {
                equipmentForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    const name = document.getElementById('equipment-name').value;
                    const description = document.getElementById('equipment-description').value;
                    const price = parseInt(document.getElementById('equipment-price').value);
                    const quantity = parseInt(document.getElementById('equipment-quantity').value);
                    const icon = document.getElementById('equipment-icon').value;

                    if (editingEquipmentId) {
                        equipmentData[editingEquipmentId] = {
                            ...equipmentData[editingEquipmentId],
                            name,
                            description,
                            price,
                            quantity,
                            icon
                        };
                    } else {
                        const newId = generateId();
                        equipmentData[newId] = {
                            id: newId,
                            name,
                            description,
                            price,
                            quantity,
                            icon
                        };
                    }

                    renderEquipmentList();
                    closeEquipmentModal();
                });
            }

            // 點擊設備模態框背景關閉
            const equipmentModal = document.getElementById('equipment-modal');
            if (equipmentModal) {
                equipmentModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeEquipmentModal();
                    }
                });
            }

            // 點擊裁切模態框背景關閉
            const cropModal = document.getElementById('crop-modal');
            if (cropModal) {
                cropModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeCropModal();
                    }
                });
            }
        });
    </script>
</body>
</html> 